# ソリューション概要 — カクスキャン（KakuScan）

## ユーザーフロー

```
📱 撮影 → 🔍 OCR読取 → 🏷️ 自動仕分け → 📊 集計 → 📄 申告書生成 → ✅ 提出
```

### Step 1: 撮影（3秒）
- スマホカメラで領収書を撮影
- 複数枚連続撮影モード対応
- 傾き・影を自動補正

### Step 2: AI-OCR読取（2秒）
- 店名、日付、金額、品目を自動抽出
- 手書き領収書にも対応（日本語手書きOCR）
- 消費税率（8%/10%）の自動判別
- インボイス登録番号の読取

### Step 3: 自動仕分け（1秒）
- LLMが勘定科目を推定（交通費、接待交際費、消耗品費 etc.）
- ユーザーの過去の修正パターンを学習
- 確信度表示（95%以上は自動確定、未満はユーザー確認）

### Step 4: ダッシュボード
- 月別・科目別の経費グラフ
- 予算対比・前年比較
- 異常値アラート（急な経費増加等）

### Step 5: 申告書生成
- 確定申告書B（第一表・第二表）を自動生成
- 青色申告決算書対応
- e-Tax用XMLデータ出力
- PDF出力（印刷提出用）

## 画面設計

### メイン画面構成

| 画面 | 機能 | UI方針 |
|------|------|--------|
| ホーム | 今月の経費サマリー、未処理通知 | ダッシュボード型 |
| スキャン | カメラ起動、撮影、プレビュー | フルスクリーンカメラ |
| 読取結果 | OCR結果の確認・修正 | カード型、スワイプ操作 |
| 仕訳一覧 | 月別・科目別の仕訳リスト | テーブル+フィルター |
| レポート | 経費分析グラフ | チャート中心 |
| 申告書 | 生成・プレビュー・出力 | ステップウィザード |
| 設定 | 事業情報、勘定科目カスタム | フォーム型 |

### スマホファーストUI
- **ワンハンド操作**: 主要操作は片手で完結
- **大きなタップターゲット**: 最小48px
- **直感的ジェスチャー**: スワイプで仕分け変更、長押しで削除
- **ダークモード対応**: 夜間の入力作業に配慮

## 技術スタック

### フロントエンド
```
React Native（iOS/Android）
  ├── Expo（ビルド・配布）
  ├── React Native Camera（撮影）
  ├── React Native Vision Camera（リアルタイムプレビュー）
  └── Nativewind（スタイリング）

Next.js（Web版・管理画面）
  ├── Tailwind CSS
  ├── Recharts（グラフ）
  └── React PDF（申告書プレビュー）
```

### バックエンド
```
Supabase
  ├── PostgreSQL（データベース）
  ├── Auth（認証）
  ├── Storage（領収書画像保存）
  ├── Edge Functions（API）
  └── Realtime（同期）
```

### AI/ML
```
OCR: Google Cloud Vision API（日本語最適化）
仕分け: Claude API（勘定科目推定）
学習: ユーザーフィードバックによるファインチューニング
画像前処理: OpenCV（傾き補正、二値化）
```

### インフラ
```
ホスティング: Vercel（Web）+ EAS（モバイル）
CDN: Cloudflare
監視: Sentry + Datadog
CI/CD: GitHub Actions
```

## MVP定義（3ヶ月）

### 含むもの
- ✅ スマホ撮影 → OCR読取
- ✅ 基本的な自動仕分け（上位10科目）
- ✅ 仕訳一覧の確認・修正
- ✅ CSV/Excel出力
- ✅ ユーザー認証・データ保存

### 含まないもの（β版以降）
- ❌ 申告書自動生成
- ❌ e-Tax連携
- ❌ 税理士マッチング
- ❌ 経費分析レポート
- ❌ 法人対応

## セキュリティ要件

| 項目 | 対応 |
|------|------|
| データ暗号化 | AES-256（保存時）+ TLS 1.3（通信時） |
| 認証 | OAuth 2.0 + MFA対応 |
| 画像保存 | 暗号化ストレージ、90日後自動削除（設定変更可） |
| アクセスログ | 全API呼び出しを記録 |
| GDPR/個人情報 | データポータビリティ、削除権対応 |
| SOC 2 | Type II取得目標（2年目） |
