# ソリューション概要 — KaFun Shield

## 画面設計

### メイン画面: 花粉ヒートマップ
```
┌─────────────────────────────────┐
│ 📍 東京都渋谷区  2/17 14:00    │ ← 現在地+時刻
│ ┌─────────────────────────────┐ │
│ │                             │ │
│ │    🟢🟡🟡🟠🔴🔴🟣          │ │ ← 花粉ヒートマップ
│ │  🟢🟡🟠🔴🔴🟣🟣           │ │
│ │    🟡🟠🟠🔴🟣              │ │
│ │                             │ │
│ └─────────────────────────────┘ │
│ ◀ ━━━━━━━━●━━━━━━ ▶          │ ← 時間スライダー
│   12:00        18:00   24:00   │
│                                 │
│ ⚠️ 現在のリスク: 高い            │
│ 🎯 おすすめ: マスク+薬を服用     │
│                                 │
│ ┌────┐ ┌────┐ ┌────┐ ┌────┐  │
│ │ 🗺 │ │ 📊 │ │ 🔔 │ │ 👤 │  │ ← タブバー
│ │マップ│ │予報 │ │通知│ │設定│  │
│ └────┘ └────┘ └────┘ └────┘  │
└─────────────────────────────────┘
```

### 予報画面
- 7日間の花粉飛散予測グラフ（棒グラフ+折れ線）
- 花粉種別の内訳（スギ/ヒノキ/その他）
- 時間帯別の飛散ピーク表示

### 通知設定画面
- 登録地点の一覧（自宅・職場・学校など）
- 各地点の通知閾値設定（5段階スライダー）
- 通知時間帯の設定（朝のみ/終日）

### プロフィール画面
- 花粉症の重症度設定
- アレルギー花粉の種類選択
- 症状日記の入力・履歴

## 技術スタック

### フロントエンド
| 技術 | 選定理由 |
|------|---------|
| **Next.js 15** | SSR+ISRでSEO最適化、App Router |
| **React 19** | Server Componentsでパフォーマンス向上 |
| **Mapbox GL JS** | 高パフォーマンスのヒートマップレンダリング |
| **TailwindCSS 4** | 高速UIスタイリング |
| **Framer Motion** | マップアニメーション、スライダー |
| **Recharts** | 花粉予報グラフ |

### バックエンド
| 技術 | 選定理由 |
|------|---------|
| **Supabase** | 認証+DB+リアルタイム、無料枠大きい |
| **Edge Functions (Deno)** | 花粉データの定期取得・集計 |
| **PostGIS** | 地理空間データの高速クエリ |
| **Redis (Upstash)** | ヒートマップタイルのキャッシュ |

### データソース
| ソース | データ | 更新頻度 |
|--------|--------|---------|
| **環境省花粉観測システム (はなこさん)** | リアルタイム花粉飛散量 | 1時間 |
| **気象庁メッシュ予報** | 風向・風速・降水量 | 3時間 |
| **Open-Meteo API** | 気温・湿度・紫外線 | 1時間 |
| **ユーザー報告** | 症状レベル（クラウドソーシング） | リアルタイム |

### インフラ
| サービス | 用途 |
|---------|------|
| **Vercel** | フロントエンドホスティング |
| **Supabase Cloud** | バックエンド |
| **Firebase Cloud Messaging** | プッシュ通知 |
| **GitHub Actions** | CI/CD |

## MVP（Minimum Viable Product）

### MVP機能（4週間で開発）

#### Week 1: 基盤
- [x] Next.js プロジェクトセットアップ
- [x] Mapbox ヒートマップ表示（都道府県レベル）
- [x] 環境省データの自動取得バッチ

#### Week 2: コア機能
- [x] 500mメッシュのヒートマップ表示
- [x] 時間スライダー（24時間予測）
- [x] 現在地の花粉レベル表示

#### Week 3: パーソナル機能
- [x] ユーザー認証（Supabase Auth）
- [x] 地点登録（最大3地点）
- [x] プッシュ通知

#### Week 4: 磨き込み
- [x] AI対策レコメンド（基本版）
- [x] PWA対応（オフライン閲覧）
- [x] パフォーマンスチューニング

### MVP後のロードマップ
| 時期 | 機能 |
|------|------|
| +1ヶ月 | 花粉カレンダー、症状日記 |
| +2ヶ月 | LINE連携、Apple Watch対応 |
| +3ヶ月 | B2Bダッシュボード、データAPI |
| +6ヶ月 | PM2.5・黄砂対応、海外展開準備 |

## システムアーキテクチャ

```
[環境省API] ──┐
[気象庁API] ──┤
[Open-Meteo] ─┤──→ [Edge Functions] ──→ [PostGIS] ──→ [Mapbox Tileset]
[ユーザー報告] ┘      (データ集約)       (空間集計)     (タイル生成)
                                                          │
                                           ┌──────────────┘
                                           ▼
                              [Vercel/Next.js] ──→ [ブラウザ/PWA]
                                     │
                              [Supabase Auth] ──→ [プッシュ通知]
                              [Redis Cache]
```
