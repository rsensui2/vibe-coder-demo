"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.maybeOpenBrowser = void 0;
const renderer_1 = require("@remotion/renderer");
const better_opn_1 = require("./better-opn");
const getShouldOpenBrowser = ({ configValueShouldOpenBrowser, parsedCliOpen, }) => {
    var _a;
    if (parsedCliOpen === false) {
        return {
            shouldOpenBrowser: false,
            reasonForBrowserDecision: '--no-open specified',
        };
    }
    if (((_a = process.env.BROWSER) !== null && _a !== void 0 ? _a : '').toLowerCase() === 'none') {
        return {
            shouldOpenBrowser: false,
            reasonForBrowserDecision: 'env BROWSER=none was set',
        };
    }
    if (configValueShouldOpenBrowser === false) {
        return { shouldOpenBrowser: false, reasonForBrowserDecision: 'Config file' };
    }
    return { shouldOpenBrowser: true, reasonForBrowserDecision: 'default' };
};
const maybeOpenBrowser = async ({ browserArgs, browserFlag, configValueShouldOpenBrowser, parsedCliOpen, url, logLevel, }) => {
    const { reasonForBrowserDecision, shouldOpenBrowser } = getShouldOpenBrowser({
        configValueShouldOpenBrowser,
        parsedCliOpen,
    });
    if (shouldOpenBrowser) {
        await (0, better_opn_1.openBrowser)({
            url,
            browserArgs,
            browserFlag,
        });
    }
    else {
        renderer_1.RenderInternals.Log.verbose({ indent: false, logLevel }, `Not opening browser, reason: ${reasonForBrowserDecision}`);
    }
    return { didOpenBrowser: shouldOpenBrowser };
};
exports.maybeOpenBrowser = maybeOpenBrowser;
